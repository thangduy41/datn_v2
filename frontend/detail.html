<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Tiết Địa Điểm</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <div class="container"> <a href="index.html" class="back-link">&laquo; Quay lại trang tìm kiếm</a>
        <hr class="separator"> <div id="location-detail">
            <h1 id="locationName">Đang tải...</h1>
            <p><strong>ID:</strong> <span id="locationId"></span></p>
            <p><strong>Mô tả ngắn:</strong> <span id="locationShortDescription"></span></p>
            <p><strong>Địa chỉ:</strong> <span id="locationAddress"></span></p>
            <p><strong>Tỉnh/Thành:</strong> <span id="locationProvince"></span></p>
            
            <h3 class="detail-section-title">Mô tả chi tiết:</h3> <div id="locationFullDescription" class="full-description-content"></div> 
            </div>

        <div id="detailErrorMessage" class="error-message">
            </div>
    </div> <script>
        const API_BASE_URL = "http://127.0.0.1:5000/api/v1"; 

        async function fetchLocationDetail() {
            const urlParams = new URLSearchParams(window.location.search);
            const locationId = urlParams.get('id');
            const errorMessageDiv = document.getElementById('detailErrorMessage');

            if (!locationId) {
                document.getElementById('locationName').textContent = "Không tìm thấy ID địa điểm.";
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/location/${locationId}`);
                if (!response.ok) {
                    let errorText = `Lỗi từ server: ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorText = errorData.error || errorText;
                    } catch (e) {
                        errorText = await response.text(); 
                    }
                    throw new Error(errorText);
                }
                const data = await response.json();
                displayLocationDetail(data);
            } catch (error) {
                console.error('Lỗi khi tải chi tiết địa điểm:', error);
                document.getElementById('locationName').textContent = "Lỗi tải dữ liệu.";
                errorMessageDiv.textContent = `Lỗi: ${error.message}`;
            }
        }

        function displayLocationDetail(locationData) {
            document.getElementById('locationName').textContent = locationData.ten || "N/A";
            document.getElementById('locationId').textContent = locationData.id_dia_diem || "N/A";
            document.getElementById('locationShortDescription').textContent = locationData.mo_ta || "N/A";
            document.getElementById('locationAddress').textContent = locationData.dia_chi || "N/A";
            document.getElementById('locationProvince').textContent = locationData.tinh || "N/A";

            const fullDescriptionDiv = document.getElementById('locationFullDescription');
            let rawFullDescription = locationData.mo_ta_chi_tiet || "Không có mô tả chi tiết.";

            let processedDescription = rawFullDescription.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            fullDescriptionDiv.innerHTML = processedDescription;
        }

        window.onload = fetchLocationDetail;
    </script>
</body>
</html>